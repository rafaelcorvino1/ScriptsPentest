import argparse
import dns.resolver
from ipwhois import IPWhois
from netaddr import IPNetwork

def get_ips(domain):
    resolver = dns.resolver.Resolver()
    answers = resolver.resolve(domain, 'A')
    return [answer.address for answer in answers]

def get_netblocks(ips):
    netblocks = []
    for ip in ips:
        obj = IPWhois(ip)
        results = obj.lookup_rdap(depth=1)
        netblock_cidr = results['network']['cidr']
        netblocks.append((ip, netblock_cidr))
    return netblocks

def convert_cidr_to_range(netblock_cidr):
    ip_network = IPNetwork(netblock_cidr)
    return f'{ip_network[0]}-{ip_network[-1]}'

def main(domain):
    ips = get_ips(domain)
    print(f'Os endereços IP do domínio {domain} são: {ips}')
    netblocks = get_netblocks(ips)
    for ip, netblock_cidr in netblocks:
        netblock_range = convert_cidr_to_range(netblock_cidr)
        print(f'O netblock para o IP {ip} é {netblock_range}')

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Encontre o netblock para um domínio específico.')
    parser.add_argument('domain', type=str, help='O domínio a ser pesquisado')
    args = parser.parse_args()
    main(args.domain)
