import argparse
import dns.exception
import dns.reversename
import dns.resolver
from netaddr import iter_iprange
import concurrent.futures
import tqdm

def perform_reverse_dns(ip):
    try:
        reverse_name = dns.reversename.from_address(str(ip))
        resolved_name = str(dns.resolver.resolve(reverse_name, "PTR")[0])
        return f'IP: {ip} --> Nome: {resolved_name}'
    except dns.resolver.NXDOMAIN:
        return f'IP: {ip} --> No PTR record'
    except dns.exception.Timeout:
        return f'IP: {ip} --> Request timed out'
    except Exception as e:
        return f'Erro ao resolver o IP {ip}: {e}'

def main(ip_start, ip_end):
    ip_range = list(iter_iprange(ip_start, ip_end))
    with concurrent.futures.ThreadPoolExecutor(max_workers=20) as executor:
        results = list(tqdm.tqdm(executor.map(perform_reverse_dns, ip_range), total=len(ip_range)))
    for result in results:
        print(result)

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Execute a pesquisa de DNS reverso para um bloco de IP.')
    parser.add_argument('ip_start', type=str, help='O in√≠cio do bloco de IP.')
    parser.add_argument('ip_end', type=str, help='O fim do bloco de IP.')
    args = parser.parse_args()
    main(args.ip_start, args.ip_end)
